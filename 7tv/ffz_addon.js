(()=>{"use strict";var t={3537:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DataStructure=void 0,function(t){let e,n,o,s;t.NullObjectId="000000000000000000000000",function(t){let e;!function(t){t[t.PRIVATE=1]="PRIVATE",t[t.GLOBAL=2]="GLOBAL",t[t.HIDDEN=4]="HIDDEN",t[t.OVERRIDE_BTTV=8]="OVERRIDE_BTTV",t[t.OVERRIDE_FFZ=16]="OVERRIDE_FFZ",t[t.OVERRIDE_TWITCH_GLOBAL=32]="OVERRIDE_TWITCH_GLOBAL",t[t.OVERRIDE_TWITCH_SUBSCRIBER=64]="OVERRIDE_TWITCH_SUBSCRIBER",t[t.ZERO_WIDTH=128]="ZERO_WIDTH"}(e=t.Visibility||(t.Visibility={}))}(e=t.Emote||(t.Emote={})),function(t){let e;!function(t){t[t.TEXT=1]="TEXT",t[t.USER_MENTION=2]="USER_MENTION",t[t.EMOTE_MENTION=3]="EMOTE_MENTION",t[t.ROLE_MENTION=4]="ROLE_MENTION"}(e=t.MessagePartType||(t.MessagePartType={}))}(n=t.Notification||(t.Notification={})),function(t){t.Permission={CREATE_EMOTE:BigInt(1)<<BigInt(0),EDIT_EMOTE_SELF:BigInt(1)<<BigInt(1),EDIT_EMOTE_ALL:BigInt(1)<<BigInt(2),CREATE_REPORTS:BigInt(1)<<BigInt(3),MANAGE_REPORTS:BigInt(1)<<BigInt(4),BAN_USERS:BigInt(1)<<BigInt(5),ADMINISTRATOR:BigInt(1)<<BigInt(6),MANAGE_ROLES:BigInt(1)<<BigInt(7),MANAGE_USERS:BigInt(1)<<BigInt(8),MANAGE_EDITORS:BigInt(1)<<BigInt(9),MANAGE_STACK:BigInt(1)<<BigInt(10),EDIT_APP_META:BigInt(1)<<BigInt(11)},t.DEFAULT_PERMISSIONS=t.Permission.CREATE_EMOTE&t.Permission.EDIT_EMOTE_SELF&t.Permission.CREATE_REPORTS&t.Permission.MANAGE_EDITORS}(o=t.Role||(t.Role={})),function(t){let e;!function(t){let e;!function(t){t[t.EMOTE_CREATE=1]="EMOTE_CREATE",t[t.EMOTE_DELETE=2]="EMOTE_DELETE",t[t.EMOTE_DISABLE=3]="EMOTE_DISABLE",t[t.EMOTE_EDIT=4]="EMOTE_EDIT",t[t.EMOTE_MERGE=5]="EMOTE_MERGE",t[t.AUTH_IN=20]="AUTH_IN",t[t.AUTH_OUT=21]="AUTH_OUT",t[t.USER_CREATE=30]="USER_CREATE",t[t.USER_DELETE=31]="USER_DELETE",t[t.USER_SUSPEND=32]="USER_SUSPEND",t[t.USER_EDIT=33]="USER_EDIT",t[t.USER_CHANNEL_EMOTE_ADD=34]="USER_CHANNEL_EMOTE_ADD",t[t.USER_CHANNEL_EMOTE_REMOVE=35]="USER_CHANNEL_EMOTE_REMOVE",t[t.USER_UNBAN=36]="USER_UNBAN",t[t.USER_CHANNEL_EDITOR_ADD=37]="USER_CHANNEL_EDITOR_ADD",t[t.USER_CHANNEL_EDITOR_REMOVE=38]="USER_CHANNEL_EDITOR_REMOVE",t[t.USER_CHANNEL_EMOTE_EDIT=39]="USER_CHANNEL_EMOTE_EDIT",t[t.APP_MAINTENANCE_MODE=50]="APP_MAINTENANCE_MODE",t[t.APP_ROUTE_LOCK=51]="APP_ROUTE_LOCK",t[t.APP_LOGS_VIEW=52]="APP_LOGS_VIEW",t[t.APP_SCALE=53]="APP_SCALE",t[t.APP_NODE_CREATE=54]="APP_NODE_CREATE",t[t.APP_NODE_DELETE=55]="APP_NODE_DELETE",t[t.APP_NODE_JOIN=56]="APP_NODE_JOIN",t[t.APP_NODE_UNREF=57]="APP_NODE_UNREF"}(e=t.Type||(t.Type={}))}(e=t.Entry||(t.Entry={}))}(s=t.AuditLog||(t.AuditLog={}))}(e.DataStructure||(e.DataStructure={}))},5357:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Config=void 0,e.Config=Object.assign(Object.assign({},{apiUrl:"//api.7tv.app",wsUrl:"//ws.7tv.app",eventsUrl:"//events.7tv.app/v1",cdnUrl:"//cdn.7tv.app",secure:!0}),{social:{discordInviteID:"RKUDDZk4Zy",twitterHandle:"Official_7TV"}})},4405:function(t,e,n){var o=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(s,i){function a(t){try{d(o.next(t))}catch(t){i(t)}}function E(t){try{d(o.throw(t))}catch(t){i(t)}}function d(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,E)}d((o=o.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const s=n(5357),i=n(9664),a=n(3537);class E extends FrankerFaceZ.utilities.addon.Addon{constructor(...t){super(...t),this.inject("settings"),this.inject("chat"),this.inject("chat.emotes"),this.inject("chat.badges"),this.inject("site"),this.injectAs("siteChat","site.chat"),this.settings.add("addon.7tv_emotes.global_emotes",{default:!0,ui:{path:"Add-Ons > 7TV Emotes >> Emotes",title:"Global Emotes",description:"Enables global emotes from 7TV.",component:"setting-check-box"}}),this.settings.add("addon.7tv_emotes.channel_emotes",{default:!0,ui:{path:"Add-Ons > 7TV Emotes >> Emotes",title:"Channel Emotes",description:"Enables channel specific emotes from 7TV.",component:"setting-check-box"}}),this.settings.add("addon.7tv_emotes.update_messages",{default:!0,ui:{path:"Add-Ons > 7TV Emotes >> Events",title:"Emote update messages",description:"Show messages in chat when emotes are updated in the current channel.",component:"setting-check-box"}}),this.enable(),window.addEventListener("7TV#ChannelEmoteUpdate",(t=>{const e=JSON.parse(t.detail);this.handleChannelEmoteUpdate(e)})),this.enableAddon("ffzap-bttv")}onEnable(){return o(this,void 0,void 0,(function*(){this.chat.context.on("changed:addon.7tv_emotes.global_emotes",(()=>this.updateGlobalEmotes())),this.chat.context.on("changed:addon.7tv_emotes.channel_emotes",(()=>this.updateChannels())),this.addBadges(),this.on("chat:room-add",this.addChannel,this),this.on("chat:room-remove",this.removeChannel,this),this.updateGlobalEmotes(),this.updateChannels()}))}addChannel(t){return o(this,void 0,void 0,(function*(){yield this.addChannelSet(t)}))}removeChannel(t){this.removeChannelSet(t)}updateGlobalEmotes(){return o(this,void 0,void 0,(function*(){if(this.emotes.removeDefaultSet("addon.7tv_emotes","addon.7tv_emotes.global"),this.emotes.unloadSet("addon.7tv_emotes.global"),!this.chat.context.get("addon.7tv_emotes.global_emotes"))return;const t=yield fetch(`${d}/v2/emotes/global`);if(t.ok){const e=yield t.json(),n=[];for(const t of e)n.push(this.convertEmote(t));this.emotes.addDefaultSet("addon.7tv_emotes","addon.7tv_emotes.global",{title:"Global Emotes",source:"7TV",icon:"https://7tv.app/assets/favicon.png",emotes:n})}}))}fetchChannelEmotes(t){return o(this,void 0,void 0,(function*(){const e=yield fetch(`${d}/v2/users/${t}/emotes`);if(e.ok){const n=yield e.json(),o=[];for(const t of n)o.push(this.convertEmote(t));return this.sendMessageUp("SwitchChannel",{channelName:t,emotes:null!=o?o:[],skip_download:!0}),o}}))}getChannelSetID(t){return`addon.7tv_emotes.channel-${t.login}`}addChannelSet(t,e){return o(this,void 0,void 0,(function*(){this.removeChannelSet(t),void 0===e&&(e=yield this.fetchChannelEmotes(t.login)),this.sendMessageUp("EmoteSetUpdateFFZ",e),e&&e.length>0&&t.addSet("addon.7tv_emotes",this.getChannelSetID(t),{title:"Channel Emotes",source:"7TV",icon:"https://7tv.app/assets/favicon.png",emotes:e})}))}removeChannelSet(t){const e=this.getChannelSetID(t);t.removeSet("addon.7tv_emotes",e),this.emotes.unloadSet(e)}getChannelSet(t){return this.emotes.emote_sets[this.getChannelSetID(t)]}updateChannels(){const t=[],e=this.chat.context.get("addon.7tv_emotes.channel_emotes");for(const n of this.chat.iterateRooms())e?t.push(this.addChannel(n)):this.removeChannelSet(n);return Promise.all(t)}convertEmote(t){const e={id:t.id,name:t.name,urls:{1:t.urls[0][1],2:t.urls[1][1],3:t.urls[2][1],4:t.urls[3][1]},modifier:(t.visibility&a.DataStructure.Emote.Visibility.ZERO_WIDTH)==a.DataStructure.Emote.Visibility.ZERO_WIDTH,modifier_offset:"0",width:t.width[0],height:t.height[0],click_url:`https://7tv.app/emotes/${t.id}`,owner:{}};return t.owner&&(e.owner={display_name:t.owner.display_name,name:t.owner.login}),e}addBadges(){return o(this,void 0,void 0,(function*(){const t=yield fetch(`${d}/v2/badges?user_identifier=twitch_id`);if(t.ok){const e=yield t.json();if("object"==typeof e&&null!=e&&e.badges)for(const t of e.badges){const e=`addon.7tv_emotes.badge-${t.id}`;this.badges.loadBadgeData(e,{id:t.id,title:t.tooltip,slot:69,image:t.urls[1][1],urls:{1:t.urls[2][1]},svg:!1});for(const n of t.users)this.chat.getUser(String(n)).addBadge("addon.7tv_emotes",e)}}}))}handleChannelEmoteUpdate(t){for(const e of this.chat.iterateRooms())if(e.login==t.channel){const n=this.getChannelSet(e);if(n){const o=n.emotes||{};"REMOVE"===t.action?delete o[t.emote_id]:"ADD"!==t.action&&"UPDATE"!==t.action||(o[t.emote_id]=this.convertEmote(Object.assign(Object.assign({},t.emote),{id:t.emote_id,name:t.name}))),this.addChannelSet(e,Object.values(o))}}}sendMessageUp(t,e){window.dispatchEvent(new CustomEvent(`7TV#${t}`,{detail:JSON.stringify(e)}))}enableAddon(t){return o(this,void 0,void 0,(function*(){let e=yield this.resolve("addons");yield e.loadAddon(t),e.enableAddon(t,!1),(yield this.resolve(`addon.${t}`)).external=!0;let n=e.getAddon(t);n.description=`Enabled externally by 7TV\n\n(${n.description})`}))}}E.register({id:"7tv-emotes",name:"7TV",author:"7TV",description:"7TV FrankerFaceZ compatibility Add-On",version:i.version,website:"https://7tv.app",settings:"add_ons.7tv_emotes",icon:"https://7tv.app/assets/icons/icon-96x96.png"});const d=`${s.Config.secure?"https":"http"}:${s.Config.apiUrl}`},9664:t=>{t.exports=JSON.parse('{"manifest_version":3,"name":"7TV","description":"7TV is an emote service and extension for Twitch and YouTube","version":"2.1.4","action":{"page_action":{"default_icon":"icon128.png"}},"background":{"service_worker":"background.js","type":"module"},"content_scripts":[{"matches":["*://*.twitch.tv/*","*://*.youtube.com/*"],"js":["content.js"],"all_frames":true,"runAt":"document_start"}],"web_accessible_resources":[{"resources":["twitch.js","youtube.js","ffz_hook.js","ffz_addon.js","styles/Style.css","image/*.webp"],"matches":["*://*.twitch.tv/*","*://*.youtube.com/*"]}],"permissions":["storage"],"host_permissions":["*://*.twitch.tv/*"],"icons":{"16":"icon16.png","48":"icon48.png","128":"icon128.png"}}')}},e={};!function n(o){var s=e[o];if(void 0!==s)return s.exports;var i=e[o]={exports:{}};return t[o].call(i.exports,i,i.exports,n),i.exports}(4405)})();